---
sidebar_position: 20
title: Tam DÃ¼ÄŸÃ¼m ile Teknik Rehber
---

:::caution
Bu sayfa, dApp yÄ±ÄŸÄ±nÄ±mÄ±z daha kararlÄ± hale gelene kadar WIP'tir ğŸš§
:::

Bu belge, Alephium ana aÄŸÄ±ndaki akÄ±llÄ± kontratlarÄ±n oluÅŸturulmasÄ±, daÄŸÄ±tÄ±lmasÄ± ve kullanÄ±mÄ±yla ilgili rehberlik eder.

Ã–ncelikle herhangi bir kullanÄ±cÄ±nÄ±n **ALPH** tokenlerini takas etmesine izin veren bir kontratÄ± daÄŸÄ±tacaÄŸÄ±z. Daha sonra, kontratÄ± token satÄ±n almak iÃ§in Ã§aÄŸÄ±ran bir betik daÄŸÄ±tacaÄŸÄ±z.

Bu belge, [Ã‡in akÄ±llÄ± kontrat Ã¶ÄŸretici ve belgelerine](https://github.com/Lbqds/alephium-docs/blob/master/contract.md) dayanmaktadÄ±r, [Lbqds](https://github.com/Lbqds) tarafÄ±ndan.

## Gereksinimler

Bu Ã¶ÄŸretici iÃ§in yerel olarak Ã§alÄ±ÅŸan bir dÃ¼ÄŸÃ¼m ve bir cÃ¼zdanÄ±nÄ±zÄ±n olmasÄ± gerekmektedir. Ä°lgili Ã¶ÄŸreticiler aÅŸaÄŸÄ±da listelenmiÅŸtir:

- [DÃ¼ÄŸÃ¼mÃ¼nÃ¼zÃ¼ nasÄ±l baÅŸlatacaÄŸÄ±nÄ±zÄ±](https://github.com/alephium/alephium/wiki/Starter-Guide---How-to-Launch-your-node)
- [Bir cÃ¼zdanÄ± nasÄ±l kuracaÄŸÄ±nÄ±zÄ±](https://github.com/alephium/alephium/wiki/Wallet-Guide)

Bu Ã¶ÄŸreticide `demo-1` adÄ±nda bir cÃ¼zdan kullanacaÄŸÄ±z.

## Bir token kontratÄ± oluÅŸturun ve daÄŸÄ±tÄ±n

Bu bÃ¶lÃ¼mde bir kontrat iÅŸlemini oluÅŸturacak, derleyecek, imzalayacak ve gÃ¶ndereceÄŸiz.

### Bir token KontratÄ± OluÅŸturun

Ã–ncelikle aÅŸaÄŸÄ±da gÃ¶sterildiÄŸi gibi bir token kontratÄ± oluÅŸturuyoruz:

```rust
TxContract MyToken(owner: Address, mut remain: U256) {
  pub payable fn buy(from: Address, alphAmount: U256) -> () {
    let tokenAmount = alphAmount * 1000
    assert!(remain >= tokenAmount)
    let tokenId = selfTokenId!()
    transferAlph!(from, owner, alphAmount)
    transferTokenFromSelf!(from, tokenId, tokenAmount)
    remain = remain - tokenAmount
  }
}
```

Bu basit token kontratÄ±, kullanÄ±cÄ±larÄ±n kontrat sahibine `1:1000` oranÄ±nda **ALPH** Ã¶deyerek token satÄ±n almasÄ±na izin verir. AÅŸaÄŸÄ±daki yerleÅŸik iÅŸlevleri kullanÄ±r:

- `assert!(pred)`: `pred` deÄŸeri `false` olduÄŸunda kontrat yÃ¼rÃ¼tmesini baÅŸarÄ±sÄ±z kÄ±lar
- `selfTokenId!(a)`: GeÃ§erli token kimliÄŸini dÃ¶ndÃ¼rÃ¼r, bu aynÄ± zamanda geÃ§erli kontrat kimliÄŸidir
- `transferAlph!(from, to, alphAmount)`: Adresten `from` `to`'ya `alphAmount` **ALPH** transfer eder.
- `transferTokenFromSelf!(to, tokenId, tokenAmount)`: `MyToken`'Ä±n `to` adresine `tokenAmount` tokeni transfer eder.

**Not**: `remain` deÄŸiÅŸkeni gerekli deÄŸildir ancak kontratÄ±n durum deÄŸiÅŸkenlerini anlamak iÃ§in yardÄ±mcÄ± olur. Kontrat durumunun nasÄ±l depolandÄ±ÄŸÄ±nÄ± daha sonra aÃ§Ä±klayacaÄŸÄ±z.

### Bir KontratÄ± Derleyin

Daha sonra, tam dÃ¼ÄŸÃ¼m API'si aracÄ±lÄ±ÄŸÄ±yla kontratÄ± derliyoruz.

```bash
curl -X 'POST' \
  'http://127.0.0.1:12973/contracts/compile-contract' \
  -H 'Content-Type: application/json' \
  -d '{
  "code": "TxContract MyToken(owner: Address, mut remain: U256) {\n  pub payable fn buy(from: Address, alphAmount: U256) -> () {\n    let tokenAmount = alphAmount * 1000\n    assert!(remain >= tokenAmount)\n    let tokenId = selfTokenId!()\n    transferAlph!(from, owner, alphAmount)\n    transferTokenFromSelf!(from, tokenId, tokenAmount)\n    remain = remain - tokenAmount\n  }\n}"
}'
```

YanÄ±t olarak kontratÄ±n ikili kodunu alÄ±yoruz:

```json
{
  "compiled": {
    "type": "SimpleContractByteCode",
    "bytecode": "0201402c01010204001616011343e82c1702a0011602344db117031600a0001601a7160016031602aba00116022ba101"
  },
  "fields": {
    "signature": "TxContract MyToken(owner:Address,mut remain:U256)",
    "types": ["Address", "U256"]
  },
  "functions": [
    {
      "name": "buy",
      "signature": "pub payable buy(from:Address,alphAmount:U256)->()",
      "argTypes": ["Address", "U256"],
      "returnTypes": []
    }
  ],
  "events": []
}
```

### Ä°mzasÄ±z bir kontrat iÅŸlemi oluÅŸturun

Åimdi kontrat iÅŸlemini oluÅŸturmalÄ±yÄ±z. Ä°lk olarak, ÅŸu anda kullanÄ±lan adresin publicKey'ini elde ediyoruz. Adres olarak `1Dac89UqoyQ7NPvuoX5cnYDp44UQDDEo4iMrYQwToqiRG` adresini kullanÄ±yoruz.

```bash
curl 'http://127.0.0.1:12973/wallets/demo-1/addresses/1Dac89UqoyQ7NPvuoX5cnYDp44UQDDEo4iMrYQwToqiRG'
```

AÅŸaÄŸÄ±daki yanÄ±tÄ± alÄ±yoruz:

```json
{
  "address": "1Dac89UqoyQ7NPvuoX5cnYDp44UQDDEo4iMrYQwToqiRG",
  "publicKey": "029347489f53e7050e5c7edb5ef305d33316772836370750ff747eb6dc3f5f47f1",
  "group": 3,
  "path": "m/44'/1234'/0'/0/0"
}
```

Daha sonra kontrat iÅŸlemini oluÅŸturuyoruz.

```bash
curl -X 'POST' \
  'http://127.0.0.1:12973/contracts/unsigned-tx/build-contract' \
  -H 'Content-Type: application/json' \
  -d '{
  "fromPublicKey": "029347489f53e7050e5c7edb5ef305d33316772836370750ff747eb6dc3f5f47f1",
  "bytecode": "0201402c01010204001616011343e82c1702a0011602344db117031600a0001601a7160016031602aba00116022ba101",
  "initialFields": [{"type": "Address", "value": "1Dac89UqoyQ7NPvuoX5cnYDp44UQDDEo4iMrYQwToqiRG"}, {"type": "U256", "value": "10000000000000000000000000000"}],
  "issueTokenAmount": "10000000000000000000000000000"
}'
```

Parametreler ÅŸunlardÄ±r:

- `fromPublicKey`: Åu anda kullanÄ±lan adresin genel anahtarÄ±
- `bytecode`: Kontrat ikili kodu
- `initialFields`: Kontrat yapÄ±landÄ±rÄ±cÄ±sÄ±na iletilen baÅŸlangÄ±Ã§ durum deÄŸiÅŸkenlerinin listesi
- `issueTokenAmount`: Kontrat tarafÄ±ndan verilen toplam token sayÄ±sÄ±

AÅŸaÄŸÄ±daki yanÄ±tÄ± alÄ±yoruz:

```json
{
  "group": 3,
  "unsignedTx": "000401010101000000081500bae81fae7fc67d18210b938e31e12d43c48cd9f89668957c7a5fd3e0e57f36e313c1e8d4a51000a21440300201402c01010204001616011343e82c1702a0011602344db117031600a0001601a7160016031602aba00116022ba101144031020400bae81fae7fc67d18210b938e31e12d43c48cd9f89668957c7a5fd3e0e57f36e302c8204fce5e3e2502611000000013c8204fce5e3e25026110000000ae1880013880c1174876e80001adcf9eb78826cef24403641dea9e899dbbcfc7007c21e0ff46a76189d04a830986eb7c9e00029347489f53e7050e5c7edb5ef305d33316772836370750ff747eb6dc3f5f47f100",
  "gasAmount": 57222,
  "gasPrice": "100000000000",
  "txId": "a8fa7a28618fd361fc7d8f2ad51c772ef561406ffe4a8b4fe1a5e68e84e2a4e2",
  "contractAddress": "2AKg3eFfeBANTSc1RPH4FUho8KrrzMdKMCiXeBc2X3taP"
}
```

### Bir kontratÄ± imzalayÄ±n

Daha sonra, Ã¶nceden alÄ±nan iÅŸlem hash'ini imzalÄ±yoruz.

```bash
curl -X 'POST' \
  'http://127.0.0.1:12973/wallets/demo-1/sign' \
  -H 'Content-Type: application/json' \
  -d '{
  "data": "a8fa7a28618fd361fc7d8f2ad51c772ef561406ffe4a8b4fe1a5e68e84e2a4e2"
}'
```

YanÄ±t imzayÄ± iÃ§erir.

```json
{
  "signature": "77373aeac77ca269169faada8a2f3f60301a4a0fe0f0a5d96d0c8c5551a176f140e7526662f7dbbe58b3294fcc63eac269f74e289da62c95ab8149728eb317af"
}
```

### Bir kontratÄ± gÃ¶nderin

Son olarak, kontrat iÅŸlemini Alephium aÄŸÄ±na gÃ¶nderiyoruz.

```bash
curl -X 'POST' \
  'http://127.0.0.1:12973/transactions/submit' \
  -H 'Content-Type: application/json' \
  -d '{
  "unsignedTx": "000401010101000000081500bae81fae7fc67d18210b938e31e12d43c48cd9f89668957c7a5fd3e0e57f36e313c1e8d4a51000a21440300201402c01010204001616011343e82c1702a0011602344db117031600a0001601a7160016031602aba00116022ba101144031020400bae81fae7fc67d18210b938e31e12d43c48cd9f89668957c7a5fd3e0e57f36e302c8204fce5e3e2502611000000013c8204fce5e3e25026110000000ae1880013880c1174876e80001adcf9eb757a0fc312c490625510071acc022635fa53f4649813549f0669095473a7a7d7600029347489f53e7050e5c7edb5ef305d33316772836370750ff747eb6dc3f5f47f100",
  "signature": "77373aeac77ca269169faada8a2f3f60301a4a0fe0f0a5d96d0c8c5551a176f140e7526662f7dbbe58b3294fcc63eac269f74e289da62c95ab8149728eb317af"
}'
```

Ä°stek geÃ§erliyse, aÅŸaÄŸÄ±daki gibi bir yanÄ±t alÄ±nÄ±r.

```json
{
  "txId": "a8fa7a28618fd361fc7d8f2ad51c772ef561406ffe4a8b4fe1a5e68e84e2a4e2",
  "fromGroup": 3,
  "toGroup": 3
}
```

Kontrat oluÅŸturma sÃ¼recini daha net anlamak iÃ§in yukarÄ±daki iÅŸlemin belirli iÃ§eriÄŸine bakalÄ±m. Åu anda bir iÅŸlemin iÃ§eriÄŸini incelemek iÃ§in kullanÄ±cÄ± dostu bir arayÃ¼z yok, bu nedenle iÅŸlem iÃ§eren bloÄŸu dÃ¼ÄŸÃ¼m API'si aracÄ±lÄ±ÄŸÄ±yla almalÄ±yÄ±z. (Bir iÅŸlemin blok hash'ini ya gezgin veya `GET /transaction/status?txId={txId}` uÃ§ noktasÄ±yla alabilirsiniz)


```bash
curl 'http://127.0.0.1:12973/blockflow/blocks/08041abb8bc8d06c6b840ceb345a4f8953a9fbf9c32c08be34a63c93fd8dfcdf \
```

Ä°ÅŸlemler listesi alÄ±yoruz (burada okunabilirlik iÃ§in yalnÄ±zca 5 iÅŸlemden 2'sini gÃ¶steriyoruz):

```json
{
  "hash": "08041abb8bc8d06c6b840ceb345a4f8953a9fbf9c32c08be34a63c93fd8dfcdf",
  "timestamp": 1652689725997,
  "chainFrom": 3,
  "chainTo": 3,
  "height": 12,
  "deps": [
    "40d58f8563a6de46fa0efda4670aeb43a451b349d8af1403b341413d5010c0e0",
    "30b0c63cf62aa6cdc1c72e8fc2f31703b8318654b65acaaece48ee503da87845",
    "be73f0505c81184bc4691ee1ffeafaf7fbb091f412d500fc882aeecc8929e1fa",
    "8f8ddaeddfd21b003ad39dfd1d7c4593d7f63d2951aecd16de8a749edf26c23c",
    "6d258ca53dbe960adf19f899248e1d60c83ac65aac323a4ff195541b84ccfb4d",
    "4862925410e6951836bd8808b94a8492ca5d718ec642d375f170e5b3b8ca51ce",
    "c5a260997400e9512b6e1ca41c18653580e39ecdbd33c26f9ee971b6f2bb96cf"
  ],
  "transactions": [
    {
      "unsigned": {
        "txId": "a8fa7a28618fd361fc7d8f2ad51c772ef561406ffe4a8b4fe1a5e68e84e2a4e2",
        "version": 0,
        "networkId": 4,
        "scriptOpt": "010101000000081500bae81fae7fc67d18210b938e31e12d43c48cd9f89668957c7a5fd3e0e57f36e313c1e8d4a51000a21440300201402c01010204001616011343e82c1702a0011602344db117031600a0001601a7160016031602aba00116022ba101144031020400bae81fae7fc67d18210b938e31e12d43c48cd9f89668957c7a5fd3e0e57f36e302c8204fce5e3e2502611000000013c8204fce5e3e25026110000000ae18",
        "gasAmount": 57222,
        "gasPrice": "100000000000",
        "inputs": [
          {
            "outputRef": {
              "hint": -1378902345,
              "key": "8826cef24403641dea9e899dbbcfc7007c21e0ff46a76189d04a830986eb7c9e"
            },
            "unlockScript": "00029347489f53e7050e5c7edb5ef305d33316772836370750ff747eb6dc3f5f47f1"
          }
        ],
        "fixedOutputs": []
      },
      "scriptExecutionOk": true,
      "contractInputs": [],
      "generatedOutputs": [
        {
          "type": "ContractOutput",
          "hint": 585739684,
          "key": "e847a0a9212bcdc07ddc1b74526c0523f11042e13330c9d889e4bc16f74e084c",
          "alphAmount": "1000000000000",
          "address": "2AKg3eFfeBANTSc1RPH4FUho8KrrzMdKMCiXeBc2X3taP",
          "tokens": [
            {
              "id": "e847a0a9212bcdc07ddc1b74526c0523f11042e13330c9d889e4bc16f74e084c",
              "amount": "10000000000000000000000000000"
            }
          ]
        },
        {
          "type": "AssetOutput",
          "hint": -1378902345,
          "key": "1d4b4f18b41e34e64d9e8fe6ee038ef8acaa8763f7b276b3b157120d393857bd",
          "alphAmount": "6499975998000000000000",
          "address": "1Dac89UqoyQ7NPvuoX5cnYDp44UQDDEo4iMrYQwToqiRG",
          "tokens": [],
          "lockTime": 0,
          "additionalData": ""
        }
      ],
      "inputSignatures": [
        "1def939243491d681b68790a2c0d906c50a3f3bef453cc47ca6822b669d6437c565af0ba9d7cd191cd99144f8fa07fe07effe6c3b21d4a9e9898d1a4eea3ae82"
      ],
      "scriptSignatures": []
    },
    {
      "unsigned": {
        "txId": "ee023aea5778fd390cc16dc2a706647c3490cf888ed90cfe4505257863e7fb31",
        "version": 0,
        "networkId": 4,
        "gasAmount": 20000,
        "gasPrice": "1000000000",
        "inputs": [],
        "fixedOutputs": [
          {
            "hint": -11128529,
            "key": "e895ec4b15e4b50e3c21e04f23dfa5e3ea424e8db92bb10d52c10b3761905665",
            "alphAmount": "1879000000000000000",
            "address": "17UjAgeAVixkYksn5snhQ4k1CpGAoBJmdsBNGdyHWqm4M",
            "tokens": [],
            "lockTime": 1652690325997,
            "additionalData": "030300000180cbfbea2d"
          }
        ]
      },
      "scriptExecutionOk": true,
      "contractInputs": [],
      "generatedOutputs": [],
      "inputSignatures": [],
      "scriptSignatures": []
    }
  ],
  "nonce": "c55b55079d5eb165ee7cc093ffde19f6867090621d16ef61",
  "version": 0,
  "depStateHash": "e500d692f7fe6daa400b81d4f78b300f78fbf926a20c03b51ada40b37f441ded",
  "txsHash": "72913f92b28be354026409f9b7c0d11e2b763c99de5bb0eeb1bd9a6b92aabee8",
  "target": "20ffffff"
}
```

Sadece `a8fa7a28618fd361fc7d8f2ad51c772ef561406ffe4a8b4fe1a5e68e84e2a4e2` kimliÄŸine sahip iÅŸleme odaklanÄ±yoruz.

```json
{
  "unsigned": {
    "txId": "a8fa7a28618fd361fc7d8f2ad51c772ef561406ffe4a8b4fe1a5e68e84e2a4e2",
    "version": 0,
    "networkId": 4,
    "scriptOpt": "010101000000081500bae81fae7fc67d18210b938e31e12d43c48cd9f89668957c7a5fd3e0e57f36e313c1e8d4a51000a21440300201402c01010204001616011343e82c1702a0011602344db117031600a0001601a7160016031602aba00116022ba101144031020400bae81fae7fc67d18210b938e31e12d43c48cd9f89668957c7a5fd3e0e57f36e302c8204fce5e3e2502611000000013c8204fce5e3e25026110000000ae18",
    "gasAmount": 57222,
    "gasPrice": "100000000000",
    "inputs": [
      {
        "outputRef": {
          "hint": -1378902345,
          "key": "8826cef24403641dea9e899dbbcfc7007c21e0ff46a76189d04a830986eb7c9e"
        },
        "unlockScript": "00029347489f53e7050e5c7edb5ef305d33316772836370750ff747eb6dc3f5f47f1"
      }
    ],
    "fixedOutputs": []
  },
  "scriptExecutionOk": true,
  "contractInputs": [],
  "generatedOutputs": [
    {
      "type": "ContractOutput",
      "hint": 585739684,
      "key": "e847a0a9212bcdc07ddc1b74526c0523f11042e13330c9d889e4bc16f74e084c",
      "alphAmount": "1000000000000",
      "address": "2AKg3eFfeBANTSc1RPH4FUho8KrrzMdKMCiXeBc2X3taP",
      "tokens": [
        {
          "id": "e847a0a9212bcdc07ddc1b74526c0523f11042e13330c9d889e4bc16f74e084c",
          "amount": "10000000000000000000000000000"
        }
      ]
    },
    {
      "type": "AssetOutput",
      "hint": -1378902345,
      "key": "1d4b4f18b41e34e64d9e8fe6ee038ef8acaa8763f7b276b3b157120d393857bd",
      "alphAmount": "6499975998000000000000",
      "address": "1Dac89UqoyQ7NPvuoX5cnYDp44UQDDEo4iMrYQwToqiRG",
      "tokens": [],
      "lockTime": 0,
      "additionalData": ""
    }
  ],
  "inputSignatures": [
    "1def939243491d681b68790a2c0d906c50a3f3bef453cc47ca6822b669d6437c565af0ba9d7cd191cd99144f8fa07fe07effe6c3b21d4a9e9898d1a4eea3ae82"
  ],
  "scriptSignatures": []
}
```

Bu iÅŸlemin bir giriÅŸi ve iki Ã§Ä±ktÄ±sÄ± var. AÅŸaÄŸÄ±da bazÄ± alanlarÄ±n aÃ§Ä±klamasÄ± bulunmaktadÄ±r:

- `outputRef`: UTXO'ya iÅŸaretÃ§i
- `key`: UTXO hash'i
- `type`: iÅŸlem Ã§Ä±kÄ±ÅŸÄ±nÄ±n tÃ¼rÃ¼, `ContractOutput` veya `AssetOutput`
- `address`: `kontrat` veya `varlÄ±k` adresinin base58 kodlamasÄ±
- `alphAmount`: Adrese ait **ALPH** miktarÄ±
- `tokens`: Adrese ait tokenlerin listesi
- `tokens.id`: kontrat kimliÄŸi
- `tokens.amount`: sahip olunan token miktarÄ±

Ä°lk Ã§Ä±ktÄ±, yeni oluÅŸturduÄŸumuz kontrattÄ±r. Kontrat adresinin tam olarak tanÄ±mladÄ±ÄŸÄ±mÄ±z `issueTokenAmount` olduÄŸunu gÃ¶rÃ¼yoruz.

Ä°kinci Ã§Ä±ktÄ±, adresimiz `1Dac89UqoyQ7NPvuoX5cnYDp44UQDDEo4iMrYQwToqiRG` tarafÄ±ndan gÃ¶nderilen iÅŸlemin UTXO Ã§Ä±ktÄ±sÄ±dÄ±r. Bu adresin herhangi bir tokeni yoktur.

## Bir betik oluÅŸturun ve daÄŸÄ±tÄ±n

Kontrat baÅŸarÄ±yla oluÅŸturulduktan sonra, `Mytoken.buy` yÃ¶ntemini Ã§aÄŸÄ±rmak iÃ§in bir `TxScript` daÄŸÄ±tacaÄŸÄ±z. Bu Ã¶rnekte, kontratÄ± oluÅŸturmak iÃ§in kullanÄ±lanla farklÄ± bir adres olan `1Borbt3zgchtQyrTrLxhUeAknP4cxYqYkNQUrth5V7U6h` adresini kullanarak Ã¶deyeceÄŸiz.

KontratÄ± gÃ¶ndermek iÃ§in kullanÄ±lan adresle aynÄ± olmayan bir adresle de Ã¶deme yapmak istiyorsanÄ±z, lÃ¼tfen adresinizin kontratla aynÄ± gruba ait olduÄŸundan emin olun. Kontrat grubunu, iÅŸlem bloÄŸunun `chainFrom` alanÄ±nÄ± kontrol ederek bulabilirsiniz. Ã–rneÄŸimizde, kontrat 3. gruptadÄ±r, ancak sizin iÃ§in farklÄ± bir grupta olabilir. Bir adresin grubunu `GET addresses/{address}/group` uÃ§ noktasÄ±nda doÄŸrulayabilirsiniz. DeÄŸilse, `POST/wallets/{wallet_name}/derive-next-address`'i kullanarak doÄŸru gruptaki bir adres elde edene kadar yeni adresler tÃ¼retebilirsiniz. Yeni adresler `0` bakiye ile baÅŸlatÄ±ldÄ±ÄŸÄ±ndan, bu yeni adrese bazÄ± **ALPH** transfer etmeniz gerekecektir. Son olarak, etkin adresinizi `POST wallets/{wallet_name}/change-active-address` uÃ§ noktasÄ±nda deÄŸiÅŸtirin.

### Bir TxScript OluÅŸturun

Ã–ncelikle, birkaÃ§ token satÄ±n almak iÃ§in `TxScript` oluÅŸturuyoruz.

```rust
TxScript Main {
  pub payable fn main() -> () {
    approveAlph!(@1Borbt3zgchtQyrTrLxhUeAknP4cxYqYkNQUrth5V7U6h, 1000000000000000000)
    let contract = MyToken(#e847a0a9212bcdc07ddc1b74526c0523f11042e13330c9d889e4bc16f74e084c)
    contract.buy(@1Borbt3zgchtQyrTrLxhUeAknP4cxYqYkNQUrth5V7U6h, 1000000000000000000)
  }
}
```

Ä°ÅŸte bu kodun kÄ±sa bir aÃ§Ä±klamasÄ±:

- `approveAlph!(address, amount)`: Adresten belirtilen miktarda `ALPH`'Ä±n betikte kullanÄ±lmasÄ±na izin verir.
- Kontrat, `id` ile yÃ¼klenir
- 1 **ALPH** karÅŸÄ±lÄ±ÄŸÄ±nda 1000 token almak iÃ§in `MyToken.buy` yÃ¶ntemini Ã§aÄŸÄ±rÄ±n

Sonraki adÄ±mlar Ã¶nceki bÃ¶lÃ¼mlere Ã§ok benzer. BetiÄŸi derleyecek, oluÅŸturacak, imzalayacak ve gÃ¶ndereceÄŸiz.

### Bir BetiÄŸi Derleyin

Betikleri ikili kod haline getirmek iÃ§in dÃ¼ÄŸÃ¼m API'sini sorguluyoruz. **LÃ¼tfen `TxScript` kodunuzun ardÄ±ndan `MyToken` kontratÄ±nÄ±n kaynak kodunu eklediÄŸinizden emin olun.**

```bash
curl -X 'POST' \
  'http://127.0.0.1:12973/contracts/compile-script' \
  -H 'Content-Type: application/json' \
  -d '{
  "code": "TxScript Main {\n  pub payable fn main() -> () {\n    approveAlph!(@1Borbt3zgchtQyrTrLxhUeAknP4cxYqYkNQUrth5V7U6h, 1000000000000000000)\n    let contract = MyToken(#e847a0a9212bcdc07ddc1b74526c0523f11042e13330c9d889e4bc16f74e084c)\n    contract.buy(@1Borbt3zgchtQyrTrLxhUeAknP4cxYqYkNQUrth5V7U6h, 1000000000000000000)\n  }\n}\nTxContract MyToken(owner: Address, mut remain: U256) {\n  pub payable fn buy(from: Address, alphAmount: U256) -> () {\n    let tokenAmount = alphAmount * 1000\n    assert!(remain >= tokenAmount)\n    let tokenId = selfTokenId!()\n    transferAlph!(from, owner, alphAmount)\n    transferTokenFromSelf!(from, tokenId, tokenAmount)\n    remain = remain - tokenAmount\n  }\n}"
}'
```

AÅŸaÄŸÄ±dakine benzer bir yanÄ±t alacaksÄ±nÄ±z:

```json
{
  "compiled": {
    "type": "SimpleScriptByteCode",
    "bytecode": "010101000100091500a095abc2f02eaf33573e17d9c5f6946da5903459f4e752146b847b3831a339c613c40de0b6b3a7640000a2144020e847a0a9212bcdc07ddc1b74526c0523f11042e13330c9d889e4bc16f74e084c17001500a095abc2f02eaf33573e17d9c5f6946da5903459f4e752146b847b3831a339c613c40de0b6b3a764000016000100"
  },
  "functions": [
    {
      "name": "main",
      "signature": "pub payable main()->()",
      "argTypes": [],
      "returnTypes": []
    }
  ],
  "events": []
}
```

### Ä°mzasÄ±z bir betik iÅŸlemi oluÅŸturun

Ä°lk olarak, etkin adresin publicKey'ini alÄ±yoruz:

```bash
curl 'http://127.0.0.1:12973/wallets/demo-1/addresses/1Borbt3zgchtQyrTrLxhUeAknP4cxYqYkNQUrth5V7U6h'
```

Buna benzer bir yanÄ±t alÄ±rÄ±z:

```json
{
  "address": "1Borbt3zgchtQyrTrLxhUeAknP4cxYqYkNQUrth5V7U6h",
  "publicKey": "0203ff28b14840ee75f8e624ae4f35ae26c67e4e835975bbaac9a2046e622358d5",
  "group": 3,
  "path": "m/44'/1234'/0'/0/18"
}
```

Daha sonra imzalÄ± iÅŸlemi oluÅŸtururuz:

```bash
curl -X 'POST' \
  'http://127.0.0.1:12973/contracts/unsigned-tx/build-script' \
  -H 'Content-Type: application/json' \
  -d '{
  "fromPublicKey": "0203ff28b14840ee75f8e624ae4f35ae26c67e4e835975bbaac9a2046e622358d5",
  "bytecode": "010101000100091500a095abc2f02eaf33573e17d9c5f6946da5903459f4e752146b847b3831a339c613c40de0b6b3a7640000a2144020e847a0a9212bcdc07ddc1b74526c0523f11042e13330c9d889e4bc16f74e084c17001500a095abc2f02eaf33573e17d9c5f6946da5903459f4e752146b847b3831a339c613c40de0b6b3a764000016000100"
}'
```

AÅŸaÄŸÄ±daki yanÄ±tÄ± alÄ±rÄ±z:

```json
{
  "unsignedTx": "000401010101000100091500a095abc2f02eaf33573e17d9c5f6946da5903459f4e752146b847b3831a339c613c40de0b6b3a7640000a2144020e847a0a9212bcdc07ddc1b74526c0523f11042e13330c9d889e4bc16f74e084c17001500a095abc2f02eaf33573e17d9c5f6946da5903459f4e752146b847b3831a339c613c40de0b6b3a76400001600010080013880c1174876e80001174aa36169adea3987f239001301642efa3e74c5ec1f1f185d1ab24ca2032f8bbfd267c7000203ff28b14840ee75f8e624ae4f35ae26c67e4e835975bbaac9a2046e622358d500",
  "gasAmount": 42082,
  "gasPrice": "100000000000",
  "txId": "2fe9100b8ede85114a707314f9416ada97735b68a9db9693c7d7bbbf9326daf2",
  "group": 3
}
```

### Bir betik imzalayÄ±n

Daha sonra, iÅŸlem hash'ini imzalarÄ±z:

```bash
curl -X 'POST' \
  'http://127.0.0.1:12973/wallets/demo-1/sign' \
  -H 'Content-Type: application/json' \
  -d '{
  "data": "2fe9100b8ede85114a707314f9416ada97735b68a9db9693c7d7bbbf9326daf2"
}'
```

Ve imzayÄ± alÄ±rÄ±z:

```json
{
  "signature": "df4b2e61c81304b3f3d34dd1f193010ff0d82abe53edd403c636823b1f71247a4908e963cf7c89284a30315d89ec72b3637cf50f023a6f905cd0c4e3d3c9941c"
}
```

### Bir betik gÃ¶nderin

Son olarak iÅŸlemi gÃ¶nderebiliriz.

```bash
curl -X 'POST' \
  'http://127.0.0.1:12973/transactions/submit' \
  -H 'Content-Type: application/json' \
  -d '{
  "unsignedTx": "000401010101000100091500a095abc2f02eaf33573e17d9c5f6946da5903459f4e752146b847b3831a339c613c40de0b6b3a7640000a2144020e847a0a9212bcdc07ddc1b74526c0523f11042e13330c9d889e4bc16f74e084c17001500a095abc2f02eaf33573e17d9c5f6946da5903459f4e752146b847b3831a339c613c40de0b6b3a76400001600010080013880c1174876e80001174aa36169adea3987f239001301642efa3e74c5ec1f1f185d1ab24ca2032f8bbfd267c7000203ff28b14840ee75f8e624ae4f35ae26c67e4e835975bbaac9a2046e622358d500",
  "signature": "df4b2e61c81304b3f3d34dd1f193010ff0d82abe53edd403c636823b1f71247a4908e963cf7c89284a30315d89ec72b3637cf50f023a6f905cd0c4e3d3c9941c"
}'
```

Ve `txId` ve gruplar bilgilerini alÄ±rÄ±z:

```json
{
  "txId": "2fe9100b8ede85114a707314f9416ada97735b68a9db9693c7d7bbbf9326daf2",
  "fromGroup": 3,
  "toGroup": 3
}
```

Yine, iÅŸlemi Ana AÄŸ'da bulabiliriz, iÅŸlemi iÃ§eren bloÄŸu sorgulayarak. AÅŸaÄŸÄ±daki iÅŸlem iÃ§eriÄŸini gÃ¶zlemliyoruz:


```json
{
  "hash": "0f13b84553050263b173f3aa00386d3cc22863080d4b8642b4dcdfea15af0e6f",
  "timestamp": 1652700335564,
  "chainFrom": 3,
  "chainTo": 3,
  "height": 13,
  "deps": [
    "40d58f8563a6de46fa0efda4670aeb43a451b349d8af1403b341413d5010c0e0",
    "30b0c63cf62aa6cdc1c72e8fc2f31703b8318654b65acaaece48ee503da87845",
    "be73f0505c81184bc4691ee1ffeafaf7fbb091f412d500fc882aeecc8929e1fa",
    "8f8ddaeddfd21b003ad39dfd1d7c4593d7f63d2951aecd16de8a749edf26c23c",
    "6d258ca53dbe960adf19f899248e1d60c83ac65aac323a4ff195541b84ccfb4d",
    "4862925410e6951836bd8808b94a8492ca5d718ec642d375f170e5b3b8ca51ce",
    "08041abb8bc8d06c6b840ceb345a4f8953a9fbf9c32c08be34a63c93fd8dfcdf"
  ],
  "transactions": [
    {
      "unsigned": {
        "txId": "2fe9100b8ede85114a707314f9416ada97735b68a9db9693c7d7bbbf9326daf2",
        "version": 0,
        "networkId": 4,
        "scriptOpt": "010101000100091500a095abc2f02eaf33573e17d9c5f6946da5903459f4e752146b847b3831a339c613c40de0b6b3a7640000a2144020e847a0a9212bcdc07ddc1b74526c0523f11042e13330c9d889e4bc16f74e084c17001500a095abc2f02eaf33573e17d9c5f6946da5903459f4e752146b847b3831a339c613c40de0b6b3a764000016000100",
        "gasAmount": 42082,
        "gasPrice": "100000000000",
        "inputs": [
          {
            "outputRef": {
              "hint": 390767457,
              "key": "69adea3987f239001301642efa3e74c5ec1f1f185d1ab24ca2032f8bbfd267c7"
            },
            "unlockScript": "000203ff28b14840ee75f8e624ae4f35ae26c67e4e835975bbaac9a2046e622358d5"
          }
        ],
        "fixedOutputs": []
      },
      "scriptExecutionOk": true,
      "contractInputs": [
        {
          "hint": 585739684,
          "key": "e847a0a9212bcdc07ddc1b74526c0523f11042e13330c9d889e4bc16f74e084c"
        }
      ],
      "generatedOutputs": [
        {
          "type": "AssetOutput",
          "hint": -1378902345,
          "key": "68e0b6a089ce4f6abd47d818e9accf5a88ac7714fef4eaa5b9a9d2099e5ad726",
          "alphAmount": "1000000000000000000",
          "address": "1Dac89UqoyQ7NPvuoX5cnYDp44UQDDEo4iMrYQwToqiRG",
          "tokens": [],
          "lockTime": 0,
          "additionalData": ""
        },
        {
          "type": "AssetOutput",
          "hint": 390767457,
          "key": "a11564f890f1cd3108834e0664dc1f97424cb7e1be4b68982a921a8fa2099846",
          "alphAmount": "498992000000000000000",
          "address": "1Borbt3zgchtQyrTrLxhUeAknP4cxYqYkNQUrth5V7U6h",
          "tokens": [
            {
              "id": "e847a0a9212bcdc07ddc1b74526c0523f11042e13330c9d889e4bc16f74e084c",
              "amount": "1000000000000000000000"
            }
          ],
          "lockTime": 0,
          "additionalData": ""
        },
        {
          "type": "ContractOutput",
          "hint": 585739684,
          "key": "9f8296350b307d98914e54d748d1cef42293c277f57d3ad98b309c28edc5cdf8",
          "alphAmount": "1000000000000",
          "address": "2AKg3eFfeBANTSc1RPH4FUho8KrrzMdKMCiXeBc2X3taP",
          "tokens": [
            {
              "id": "e847a0a9212bcdc07ddc1b74526c0523f11042e13330c9d889e4bc16f74e084c",
              "amount": "9999999000000000000000000000"
            }
          ]
        }
      ],
      "inputSignatures": [
        "df4b2e61c81304b3f3d34dd1f193010ff0d82abe53edd403c636823b1f71247a4908e963cf7c89284a30315d89ec72b3637cf50f023a6f905cd0c4e3d3c9941c"
      ],
      "scriptSignatures": []
    },
    {
      "unsigned": {
        "txId": "d9468e7b33300cb2824147166c5ee441e3865f4bc23563e54aff117810a290fa",
        "version": 0,
        "networkId": 4,
        "gasAmount": 20000,
        "gasPrice": "1000000000",
        "inputs": [],
        "fixedOutputs": [
          {
            "hint": 17786109,
            "key": "e19b512d57dab97c48d2352485abe76c6707c32dc7f308e4ca0051f40f2d2228",
            "alphAmount": "1879000000000000000",
            "address": "19Sxx6RVyenkDovv6LiMW2ymxP2UfxmvGZGhmNcxq5jqX",
            "tokens": [],
            "lockTime": 1652700935564,
            "additionalData": "030300000180cc9dcdcc"
          }
        ]
      },
      "scriptExecutionOk": true,
      "contractInputs": [],
      "generatedOutputs": [],
      "inputSignatures": [],
      "scriptSignatures": []
    }
  ],
  "nonce": "5c694b2fc6f235ff20bc02661ab3724b06e2d3ae92c97d47",
  "version": 0,
  "depStateHash": "74e3cb156bebf185dee4c3160841d1cfc812bf17be1a81744fbca18a0fefff79",
  "txsHash": "73a5c883b253ef17faa935fe8edacf1ba9690f2d543dd206042b69e06170e631",
  "target": "20ffffff"
}
```

GÃ¶rÃ¼ldÃ¼ÄŸÃ¼ gibi, bir kontrat giriÅŸi var ve `outputRef.key`, daha Ã¶nce oluÅŸturduÄŸumuz kontrata iÅŸaret ediyor.

```json
"contractInputs": [
  {
    "hint": 585739684,
    "key": "e847a0a9212bcdc07ddc1b74526c0523f11042e13330c9d889e4bc16f74e084c"
  }
]
```

Bu sefer Ã¼Ã§ Ã§Ä±ktÄ±mÄ±z var: iki varlÄ±k ve bir kontrat. Ä°lk Ã§Ä±ktÄ±, kontrat sahibine Ã¶denen 1 **ALPH** iÃ§in yeni UTXO'dur.

```json
{
  "type": "AssetOutput",
  "hint": -1378902345,
  "key": "68e0b6a089ce4f6abd47d818e9accf5a88ac7714fef4eaa5b9a9d2099e5ad726",
  "alphAmount": "1000000000000000000",
  "address": "1Dac89UqoyQ7NPvuoX5cnYDp44UQDDEo4iMrYQwToqiRG",
  "tokens": [],
  "lockTime": 0,
  "additionalData": ""
}
```

Ä°kinci Ã§Ä±ktÄ±, kontrat sahibine Ã¶deme iÃ§in tÃ¼ketilen UTXO'larÄ±n deÄŸiÅŸimiyle eÅŸdeÄŸer yeni bir UTXO'dur. Ek olarak, `tokens` listesindeki ilk Ã¶ÄŸe, ÅŸimdi satÄ±n aldÄ±ÄŸÄ±mÄ±z tokenlere karÅŸÄ±lÄ±k gelir! Kimlik, kontratÄ±mÄ±zÄ±n kimliÄŸine karÅŸÄ±lÄ±k gelir.

```json
{
  "type": "AssetOutput",
  "hint": 390767457,
  "key": "a11564f890f1cd3108834e0664dc1f97424cb7e1be4b68982a921a8fa2099846",
  "alphAmount": "498992000000000000000",
  "address": "1Borbt3zgchtQyrTrLxhUeAknP4cxYqYkNQUrth5V7U6h",
  "tokens": [
    {
      "id": "e847a0a9212bcdc07ddc1b74526c0523f11042e13330c9d889e4bc16f74e084c",
      "amount": "1000000000000000000000"
    }
  ],
  "lockTime": 0,
  "additionalData": ""
}
```

ÃœÃ§Ã¼ncÃ¼ Ã§Ä±ktÄ±, takas sonrasÄ± kontrattÄ±r. Token miktarÄ±nÄ±n `10000000000000000000000000000` den `9999999000000000000000000000` e deÄŸiÅŸtiÄŸini gÃ¶zlemliyoruz. Fark, satÄ±n aldÄ±ÄŸÄ±mÄ±z token miktarÄ±na eÅŸittir.

```json
{
  "type": "ContractOutput",
  "hint": 585739684,
  "key": "9f8296350b307d98914e54d748d1cef42293c277f57d3ad98b309c28edc5cdf8",
  "alphAmount": "1000000000000",
  "address": "2AKg3eFfeBANTSc1RPH4FUho8KrrzMdKMCiXeBc2X3taP",
  "tokens": [
    {
      "id": "e847a0a9212bcdc07ddc1b74526c0523f11042e13330c9d889e4bc16f74e084c",
      "amount": "9999999000000000000000000000"
    }
  ]
}
```

Tebrikler! Alephium'da ilk akÄ±llÄ± kontratÄ±nÄ±zÄ± baÅŸarÄ±yla daÄŸÄ±ttÄ±nÄ±z ve kullandÄ±nÄ±z! ğŸš€

## Kontrat Durumu

Ã–nceki bÃ¶lÃ¼mlerden gÃ¶rebileceÄŸimiz gibi:

- Bir kontrat oluÅŸturulduÄŸunda, bir kontrat Ã§Ä±kÄ±ÅŸÄ± oluÅŸturulur, token verilmiÅŸ olsa bile. Bir token verilmiÅŸse, Ã§Ä±kÄ±ÅŸ token listesinde baÅŸlangÄ±Ã§ta belirli bir sayÄ±da token iÃ§erir.
- KontratÄ± Ã§aÄŸÄ±rmak, kontrat Ã§Ä±kÄ±ÅŸÄ±nÄ± tÃ¼ketir ve yeni bir kontrat Ã§Ä±kÄ±ÅŸÄ± oluÅŸturur. YukarÄ±daki Ã¶rnekte, kontratÄ±n oluÅŸturulduÄŸunda oluÅŸturulan kontrat Ã§Ä±kÄ±ÅŸÄ± tÃ¼ketilir ve ardÄ±ndan yeni bir kontrat Ã§Ä±kÄ±ÅŸÄ± oluÅŸturulur.
- KontratÄ± Ã§aÄŸÄ±rmak aynÄ± zamanda kontratÄ±n durumunu deÄŸiÅŸtirebilir. YukarÄ±daki Ã¶rnekte, `MyToken.buy` Ã§aÄŸrÄ±ldÄ±ktan sonra durum deÄŸiÅŸecektir.

Kontrat durumunun Ã¶zellikle neler iÃ§erdiÄŸine bir gÃ¶z atalÄ±m:

```scala
final case class ContractState private (
    codeHash: Hash,
    initialStateHash: Hash,
    fields: AVector[Val],
    contractOutputRef: ContractOutputRef
)
```



alanlar ÅŸunlardÄ±r:

- `codeHash`: Kontrat kodunun hash'i.
- `initialStateHash`: BaÅŸlangÄ±Ã§ kontrat durumunun hash'i
- `fields`: Durum deÄŸerlerinin vektÃ¶rÃ¼. Ã–rneÄŸin, `MyToken` Ã¶rneÄŸinde `AVector(owner, remain)`.
- `contractOutputRef`: Kontrat Ã§Ä±kÄ±ÅŸÄ±na iÅŸaretÃ§i

KontratÄ± Ã§aÄŸÄ±rma ve durumunu deÄŸiÅŸtirme sÃ¼reci genellikle ÅŸÃ¶yle olur:

1. DÃ¼nya Durumu'ndan kontrat durumunu yÃ¼kleyin, bu, UTXO'lar, akÄ±llÄ± kontratlar durumu ve kodu iÃ§in bir depolama alanÄ±dÄ±r.
2. YÃ¼rÃ¼tme yÃ¶ntemi Ã¶denebilir olduÄŸunda `contractOutputRef` tarafÄ±ndan iÅŸaret edilen kontrat Ã§Ä±kÄ±ÅŸÄ±nÄ± yÃ¼kleyin
3. Kontrat yÃ¼rÃ¼tmesi, kontrat durumunu deÄŸiÅŸtiriyorsa, DÃ¼nya Durumu'ndaki kontrat durumu gÃ¼ncellenecektir
4. Kontrat yeni bir kontrat Ã§Ä±kÄ±ÅŸÄ± Ã¼retirse, kontrat durumu gÃ¼ncellenecek ve eski kontrat Ã§Ä±kÄ±ÅŸÄ± silinecektir

Ek olarak, kontratlar oluÅŸtururken ve Ã§aÄŸÄ±rÄ±rken karÅŸÄ±laÅŸÄ±labilecek hatalar ve Ã§Ã¶zÃ¼mleri hakkÄ±nda kÄ±saca bahsedeceÄŸiz:

- NotEnoughBalance: Bu yalnÄ±zca madencilik Ã¶dÃ¼llerinin veya diÄŸer transferlerin elde edilmesiyle Ã§Ã¶zÃ¼lebilir.
- OutOfGas: VarsayÄ±lan gaz oldukÃ§a kÃ¼Ã§Ã¼ktÃ¼r ve genellikle kontratlar oluÅŸturulurken ve Ã§aÄŸÄ±rÄ±lÄ±rken yeterli deÄŸildir, bu nedenle genellikle tÃ¼ketilen gazÄ± manuel olarak belirtmek gerekir.
- AmountIsDustOrZero: Sistemin, Ã§ok kÃ¼Ã§Ã¼k miktarlardaki Ã§Ä±ktÄ±larÄ± reddetmesini Ã¶nlemek iÃ§in bir Ã¶nlem olarak, sistem Ã§ok kÃ¼Ã§Ã¼k miktarlardaki Ã§Ä±ktÄ±larÄ± reddeder. Daha fazla bilgi iÃ§in lÃ¼tfen [buraya](misc/On-dust-outputs-and-state-explosion.md) bakÄ±nÄ±z.

Ä°lgilenen kiÅŸiler, farklÄ± kontratlar oluÅŸturmayÄ± deneyebilir ve ETH uygulamalarÄ±nÄ± Alephium'a gÃ¶Ã§ edebilirler.